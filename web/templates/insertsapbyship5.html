<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>
        Отчет по отгрузке в SAP
    </title>
    <!-- <script src="https://unpkg.com/vue@2.1.10/dist/vue.js"></script> -->
    <style>
        .fileContainer {
            overflow: hidden;
            position: relative;
        }

        .fileContainer [type="file"] {
            cursor: inherit;
            display: block;
            font-size: 999px;
            filter: alpha(opacity=0);
            min-height: 21px;
            min-width: 100%;
            opacity: 0;
            position: absolute;
            right: 0;
            text-align: right;
            top: 0;
        }

        .fileContainer {
            background: #e3e3e3;
            float: left;
            padding: 0.5em;
            height: 21px;
        }

        .fileContainer [type="file"] {
            cursor: pointer;
        }
    </style>

</head>

<body>
    <div class="row">
        <a href="/main">
            <h2 style="color: darkslategrey;">На главную</h2>
        </a>
    
    </div>
    <!--   <div id="app"> @submit="shipmentBySAP"-->
    <div id="forms" action="http://localhost:3000/shipmentbysap" method="post">
        <table class="table">
            <thead>
                <tr>
                    <td><strong>Material</strong></td>
                    <td><strong>Qty</strong></td>
                    <td><strong>Comment</strong></td>
                    <td></td>
                </tr>
            </thead>
            <tbody>
                <!--   <form > -->
             <!--   <tr v-for="(row, index) in rows" v-bind:refs="'ref-'+index">
                    <td><input required type="number" maxlength="10" v-model="row.material" /></td>
                    <td><input type="number" v-model="row.qty" /></td>
                    <td><input type="text" v-model="row.comment" /></td>
                    <!--   <td>
                        <label class="fileContainer">
                            {{row.file.name}}
                            <input type="file" @change="setFilename($event, row)" :id="index">
                        </label>
                    </td> -->
                    <tr>
                        <td><input required type="number" maxlength="10" /></td>
                        <td><input type="number" /></td>
                        <td><input type="text" /></td>
                    <td>
                        <a class="del-btn" style="cursor: pointer">Remove</a>
                    </td>
                </tr>
                <!--   </form> -->
            </tbody>
        </table>
        <div>
            <button class="button btn-primary add-row-btn" @click="addRow">Add row</button>
        </div>
        <div>
            <button onclick="sendData()" type="submit">
                Отправить
            </button>
        </div>
    </div>

    <p class="fig2"> <img src="/images/shipmentsap2.jpg" width="780" height="650" class="img-fluid" alt="Цех"></p>

    <script type="text/javascript">
       var result = [];

        function addRow() {
            const row = document
                .getElementsByClassName('table')[0]
                .getElementsByTagName('tr')[1].cloneNode(true);

            clearInputs(row.getElementsByClassName('input'));

            document.getElementsByClassName('table')[0]
                .getElementsByTagName('tbody')[0].appendChild(row);
        }

        function clearInputs(inputs) {
            for (let i = 0; i < inputs.length; i++) {
                inputs[i].value = '';
            }
        }

        function removeElement(el) {
            el.parentNode.parentNode.remove();
        }

        function sendData() {
            // debugger;
            const resultArr = [];
            const table = document.getElementsByClassName('table')[0];
            const rows = table.getElementsByTagName('tr');

            for (let i = 1; i < rows.length; i++) {
                const columns = rows[i].getElementsByTagName('td');
                
                resultArr.push({
                    material: parseInt(columns[0].children[0].value,10),
                    qty: parseInt(columns[1].children[0].value,10),
                    comment: columns[2].children[0].value,
                });
            }
            console.log(resultArr)
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "http://localhost:3000/shipmentbysap", true);
            xhr.setRequestHeader("Content-Type", "application/json");
            //xhr.send(resultArr);
            xhr.send(JSON.stringify(resultArr));

            var inputs = document
                .getElementsByClassName('table')[0]
                .getElementsByTagName('input');

            for (let i = 0; i < inputs.length; i++) {
                inputs[i].value = '';
            }
        }

        document.addEventListener("DOMContentLoaded", function (event) {
            document
                .getElementsByClassName('add-row-btn')[0]
                .addEventListener('click', addRow);

            document.onclick = function (event) {
                var el = event.target;
                if (el.className == "del-btn") {
                    removeElement(el);
                }
            };
        });

        // var app = new Vue({
        //     el: "#forms",
        //     data: {
        //         rows: []
        //     },
        //     methods: {
        //         addRow: function () {
        //             var elem = document.createElement("tr");
        //             this.rows.push({
        //                 title: "",
        //                 description: "",
        //                 comment: ""
        //                 //  file: {
        //                 //      name: 'Choose File'
        //                 //  }
        //             });
        //         },
        //         removeElement: function (index) {
        //             this.rows.splice(index, 1);
        //         },
        //         collectData: function () {
        //             resultArr = [];
        //             for (i = 0; i < this.rows.length; i++) {
        //                 result = {
        //                     material: this.rows[i].material,
        //                     qty: this.rows[i].qty,
        //                     comment: this.rows[i].comment
        //                 };
        //                 resultArr.push(result);
        //             }
        //             console.log(resultArr);

        //             var xhr = new XMLHttpRequest();
        //             xhr.open("POST", "http://localhost:3000/shipmentbysap", true);
        //             xhr.setRequestHeader("Content-Type", "application/json");
        //             //xhr.send(resultArr);
        //             xhr.send(JSON.stringify(resultArr));

        //             var inputs = document
        //                 .getElementsByClassName('table')[0]
        //                 .getElementsByTagName('input');
                        
        //             for (let i = 0; i < inputs.length; i++) {
        //                 inputs[i].value = '';
        //             }
        //             //    xhr.send(123);
        //             //  console.log("data send")
        //         }
        //         /* sshipmentBySAP: function(e) {
        //           console.log("test");
        //           if (this.material && this.qty) {
        //             return true;
        //           }
      
        //           this.errors = [];
      
        //           if (!this.name) {
        //             this.errors.push("Требуется указать material.");
        //           }
        //           if (!this.age) {
        //             this.errors.push("Требуется указать qty.");
        //           }
      
        //           e.preventDefault();
        //         } */
        //         //,
        //         //    setFilename: function(event, row) {
        //         //       var file = event.target.files[0];
        //         //       row.file = file
        //         //   }
        //     }
        // });
    </script>
</body>

</html>